<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <title>–ë–æ—Ç-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #121212;
            color: white;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0;
            height: 100vh;
            overscroll-behavior: none;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }
        header {
            padding: 10px;
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }
        #chat {
            width: 95%;
            max-width: 900px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 10px 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .message {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 85%;
            margin: 5px 0;
            white-space: pre-wrap;
            word-break: break-word;
            animation: fadeIn 0.3s ease-in-out;
        }
        .user {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
            margin-right: 5px;
        }
        .bot {
            background-color: #1e1e1e;
            color: #a2f5a2;
            align-self: flex-start;
            margin-left: 5px;
        }
        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–±–∑–∞—Ü–µ–≤ –∏ —Å–ø–∏—Å–∫–æ–≤ */
        .bot p {
            margin: 0 0 10px 0;
        }
        .bot p:last-child {
            margin-bottom: 0;
        }
        .bot ul, .bot ol {
            margin: 5px 0;
            padding-left: 20px;
        }
        .bot li {
            margin-bottom: 3px;
        }
        footer {
            width: 95%;
            max-width: 900px;
            padding: 10px 5px;
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        input[type=text], input[type=password] {
            flex: 1;
            padding: 10px;
            font-size: 1rem;
            border-radius: 8px;
            border: none;
            background: #1e1e1e;
            color: white;
        }
        button {
            padding: 10px 15px;
            background-color: #28a745;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }
        button:hover {
            background-color: #218838;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        details {
            margin-top: 10px;
            background-color: #222;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
        .admin-panel {
            max-width: 95%;
            margin: 5px auto;
            text-align: center;
        }

        .admin-panel summary {
            cursor: pointer;
            color: #aaa;
            font-size: 12px;
            padding: 5px;
            display: inline-block;
        }

        .admin-panel-content {
            margin-top: 10px;
            padding: 15px;
            border-radius: 5px;
            background-color: #1e1e1e;
            text-align: left;
        }

        .admin-login-form, .admin-controls {
            padding: 10px;
        }

        .admin-status {
            margin-top: 10px;
            font-size: 13px;
        }

        .error-text {
            color: #dc3545;
        }

        .success-text {
            color: #28a745;
        }

        .warning-text {
            color: #ffc107;
        }

        .admin-button {
            background-color: #6c757d;
            margin-top: 10px;
        }

        .rebuild-button {
            background-color: #28a745;
        }

        hr.divider {
            margin: 15px 0;
            border-color: #444;
            border-style: solid;
            border-width: 1px 0 0 0;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        #sources-container details {
            margin-bottom: 8px;
        }

        #sources-container summary {
            cursor: pointer;
            padding: 5px;
            background-color: #333;
            border-radius: 4px;
        }

        #sources-container pre {
            margin: 8px 0 0 0;
            padding: 10px;
            background-color: #1a1a1a;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ */
        .clear-history-button {
            background-color: #6c757d;
            font-size: 12px;
            padding: 6px 8px;
            margin-right: 5px;
        }

        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media screen and (max-width: 600px) {
            header {
                padding: 8px;
                font-size: 1.2rem;
            }

            #chat {
                width: 100%;
                padding: 5px;
                margin: 0;
            }

            .message {
                max-width: 80%;
                padding: 8px 12px;
                font-size: 14px;
            }

            .user {
                margin-right: 10px;
            }

            .bot {
                margin-left: 10px;
            }

            footer {
                width: 100%;
                padding: 8px 5px;
                gap: 3px;
                margin: 0;
            }

            button {
                padding: 8px 10px;
                font-size: 14px;
            }

            input[type=text], input[type=password] {
                padding: 8px;
                font-size: 14px;
            }

            .clear-history-button {
                padding: 6px;
                font-size: 11px;
            }

            #sources-container {
                width: 100%;
                font-size: 13px;
            }

            .admin-panel-content {
                padding: 10px;
            }

            .bot p {
                margin: 0 0 8px 0;
            }

            .bot ul, .bot ol {
                padding-left: 15px;
            }
        }

        /* –ó–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ –≤ iOS */
        @media screen and (max-width: 600px) {
            input[type=text], input[type=password] {
                font-size: 16px;
            }
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å fixed –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @supports (-webkit-touch-callout: none) {
            /* CSS –¥–ª—è iOS-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
            body, html {
                height: -webkit-fill-available;
            }

            body {
                min-height: -webkit-fill-available;
            }
        }

        /* –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è virtual keyboard */
        @media screen and (max-height: 400px) and (max-width: 600px) {
            header {
                display: none;
            }

            #chat {
                max-height: 70vh;
            }
        }

        #sources-container {
            width: 95%;
            max-width: 900px;
            margin: 5px auto 15px auto;
            overflow-x: auto;
            padding: 0 5px;
            box-sizing: border-box;
        }

        @media screen and (max-width: 600px) {
            #sources-container {
                width: 100%;
                padding: 0 5px;
                margin: 5px 0 10px 0;
            }
        }
    </style>
    <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º </header> -->
  <div id="indexStatus" class="index-status" style="display: none;">
      <div class="status-indicator"></div>
      <span id="indexStatusText">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏...</span>
  </div>

  <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –≤–Ω—É—Ç—Ä–∏ div —Å id="adminControls" -->
  <div class="index-progress-container" style="display: none; margin-top: 15px;">
      <p style="margin: 5px 0; color: #ddd; font-size: 14px;">–ü—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:</p>
      <div class="progress-bar-container">
          <div class="progress-bar" id="indexProgressBar"></div>
      </div>
      <p id="indexProgressText" class="admin-status" style="margin-top: 5px;">0%</p>
  </div>

  <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º </div> –≤ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <button id="checkIndexButton" class="admin-button" style="margin-top: 10px; background-color: #17a2b8;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏</button>

  <!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç–∏–ª–∏ –≤ —Å–µ–∫—Ü–∏—é <style> -->
  .index-status {
      font-size: 12px;
      color: #aaa;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 5px;
  }

  .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #ffc107;
      margin-right: 8px;
  }

  .status-indicator.complete {
      background-color: #28a745;
  }

  .status-indicator.error {
      background-color: #dc3545;
  }

  .progress-bar-container {
      width: 100%;
      height: 20px;
      background-color: #333;
      border-radius: 10px;
      overflow: hidden;
  }

  .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #17a2b8;
      transition: width 0.5s ease;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ */
  .file-upload-container {
      margin: 10px 0;
  }

  .file-upload-button {
      background-color: #17a2b8;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      display: inline-block;
      font-size: 14px;
      margin-bottom: 10px;
  }

  .file-upload-button:hover {
      background-color: #138496;
  }

  input[type="file"] {
      display: none;
  }

  .file-name {
      display: inline-block;
      margin-left: 10px;
      font-size: 14px;
      color: #aaa;
  }

  /* –ö–Ω–æ–ø–∫–∞ –≤–≤–µ—Ä—Ö –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ */
  .scroll-top-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background-color: #28a745;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
      font-size: 20px;
  }

  .scroll-top-button.visible {
      opacity: 0.7;
  }

  .scroll-top-button:hover {
      opacity: 1;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤ */
  @media screen and (min-height: 700px) {
      #chat {
          max-height: 70vh;
      }
  }

  /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
  .message {
      position: relative;
  }

  .message-time {
      position: absolute;
      bottom: 2px;
      right: 5px;
      font-size: 10px;
      color: rgba(255, 255, 255, 0.5);
  }

  /* –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è */
  .theme-switcher {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      cursor: pointer;
      color: #ccc;
      z-index: 100;
  }

  body.light-theme {
      background-color: #f5f5f5;
      color: #333;
  }

  body.light-theme .message.bot {
      background-color: #e9e9e9;
      color: #333;
  }

  body.light-theme #question,
  body.light-theme input[type=password] {
      background: #fff;
      color: #333;
      border: 1px solid #ddd;
  }

  body.light-theme .admin-panel-content {
      background-color: #e9e9e9;
  }

  body.light-theme #sources-container details {
      background-color: #e0e0e0;
  }

  body.light-theme #sources-container summary {
      background-color: #d0d0d0;
  }

  body.light-theme #sources-container pre {
      background-color: #f0f0f0;
      color: #333;
  }

  /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏ */
  .typing-animation::after {
      content: '';
      animation: typing 1.5s infinite;
  }

  @keyframes typing {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
  }

  /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
  .bot img {
      max-width: 100%;
      border-radius: 8px;
      margin: 10px 0;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ */
  .quick-replies {
      display: flex;
      flex-wrap: wrap;
      margin-top: 10px;
      gap: 5px;
  }

  .quick-reply {
      background-color: #444;
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
  }

  .quick-reply:hover {
      background-color: #555;
  }

  /* –í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∞ */
  .code-block {
      background-color: #1e1e1e;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      overflow-x: auto;
      margin: 10px 0;
      border-left: 3px solid #28a745;
  }
</head>
<body>
    <header>–ë–æ—Ç-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</header>
    <div id="chat"></div>
    <footer>
        <button id="clearHistoryButton" class="clear-history-button">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <input type="text" id="question" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å...">
        <button id="sendButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </footer>
    <p style="font-size: 12px; color: #ccc; text-align: center; margin: 0 0 5px 0;">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–∞–∑—ã: {{last_updated}}</p>

    <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <div class="admin-panel" id="adminPanel" style="display: none;">
        <details>
            <summary>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</summary>
            <div class="admin-panel-content">
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
                <div class="admin-login-form" id="adminLoginForm">
                    <p style="margin: 0 0 10px 0; color: #ddd; font-size: 14px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</p>
                    <input type="password" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                    <button id="adminLoginButton" class="admin-button">–í–æ–π—Ç–∏</button>
                    <p id="adminLoginStatus" class="admin-status error-text" style="display: none;"></p>
                </div>

                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                <div class="admin-controls" id="adminControls" style="display: none;">
                    <p style="margin: 0 0 10px 0; color: #ddd; font-size: 14px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π:</p>
                    <button id="rebuildButton" class="rebuild-button">–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</button>
                    <span id="rebuildStatus" class="admin-status" style="display: none; margin-left: 10px;"></span>

                    <hr class="divider">

                    <button id="adminLogoutButton" class="admin-button" style="font-size: 12px;">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </details>
    </div>

    <div id="sources-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const chat = document.getElementById('chat');
            const sendButton = document.getElementById('sendButton');
            const questionInput = document.getElementById('question');
            const clearHistoryButton = document.getElementById('clearHistoryButton');
            const sourcesContainer = document.getElementById('sources-container');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                questionInput.focus();
            }, 500);

            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setViewportHeight();

            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –∏–ª–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
            window.addEventListener('resize', setViewportHeight);
            window.addEventListener('orientationchange', setViewportHeight);

            // –≠–ª–µ–º–µ–Ω—Ç—ã –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            const adminPanel = document.getElementById('adminPanel');
            const adminLoginForm = document.getElementById('adminLoginForm');
            const adminControls = document.getElementById('adminControls');
            const adminPassword = document.getElementById('adminPassword');
            const adminLoginButton = document.getElementById('adminLoginButton');
            const adminLoginStatus = document.getElementById('adminLoginStatus');
            const adminLogoutButton = document.getElementById('adminLogoutButton');
            const rebuildButton = document.getElementById('rebuildButton');
            const rebuildStatus = document.getElementById('rebuildStatus');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            adminPanel.style.display = 'block';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            const adminToken = localStorage.getItem('adminToken');
            if (adminToken) {
                // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å, —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                adminLoginForm.style.display = 'none';
                adminControls.style.display = 'block';
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            adminLoginButton.addEventListener('click', async function() {
                try {
                    const password = adminPassword.value;
                    if (!password) {
                        adminLoginStatus.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å';
                        adminLoginStatus.style.display = 'block';
                        return;
                    }

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–∞—Ä–æ–ª—è
                    const response = await fetch('/chatbot-proxy.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: 'action=login&password=' + encodeURIComponent(password)
                    });

                    const data = await response.json();

                    if (data.status === 'success') {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        localStorage.setItem('adminToken', data.token);
                        adminLoginForm.style.display = 'none';
                        adminControls.style.display = 'block';
                        adminLoginStatus.style.display = 'none';
                        adminPassword.value = '';
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                        adminLoginStatus.textContent = data.message || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
                        adminLoginStatus.style.display = 'block';
                    }
                } catch (error) {
                    adminLoginStatus.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
                    adminLoginStatus.style.display = 'block';
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', error);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
            adminLogoutButton.addEventListener('click', function() {
                localStorage.removeItem('adminToken');
                adminControls.style.display = 'none';
                adminLoginForm.style.display = 'block';
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
            rebuildButton.addEventListener('click', async function() {
                try {
                    const adminToken = localStorage.getItem('adminToken');
                    if (!adminToken) {
                        // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                        rebuildStatus.textContent = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è';
                        rebuildStatus.className = 'admin-status error-text';
                        rebuildStatus.style.display = 'block';
                        return;
                    }

                    // –ú–µ–Ω—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–Ω–æ–ø–∫–∏
                    rebuildButton.disabled = true;
                    rebuildButton.textContent = '–û–±–Ω–æ–≤–ª—è–µ–º...';
                    rebuildStatus.style.display = 'inline';
                    rebuildStatus.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...';
                    rebuildStatus.className = 'admin-status warning-text';

                    const response = await fetch('/chatbot-proxy.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: 'action=rebuild&token=' + encodeURIComponent(adminToken)
                    });

                    const data = await response.json();

                    if (data.status === 'success') {
                        rebuildStatus.textContent = '‚úì –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!';
                        rebuildStatus.className = 'admin-status success-text';

                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        if (data.message && data.message.includes('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω')) {
                            // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
                            localStorage.removeItem('adminToken');
                            adminControls.style.display = 'none';
                            adminLoginForm.style.display = 'block';
                            rebuildStatus.textContent = '–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —Å–Ω–æ–≤–∞.';
                        } else {
                            rebuildStatus.textContent = '‚úó –û—à–∏–±–∫–∞: ' + data.message;
                        }
                        rebuildStatus.className = 'admin-status error-text';
                    }
                } catch (error) {
                    rebuildStatus.textContent = '‚úó –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å';
                    rebuildStatus.className = 'admin-status error-text';
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–∑—ã:', error);
                } finally {
                    rebuildButton.disabled = false;
                    rebuildButton.textContent = '–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π';
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Enter –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
            adminPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    adminLoginButton.click();
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
            clearHistoryButton.addEventListener('click', async function() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞?')) {
                    try {
                        const response = await fetch('/chatbot-proxy.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded'
                            },
                            body: 'action=clear_history'
                        });

                        const data = await response.json();

                        if (data.status === 'success') {
                            // –û—á–∏—â–∞–µ–º —á–∞—Ç
                            chat.innerHTML = '';
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                            appendMessage('–ë–æ—Ç: –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –æ—á–∏—â–µ–Ω–∞. –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å?', 'bot');
                        } else {
                            appendMessage('–ë–æ—Ç: –ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                        appendMessage('–ë–æ—Ç: –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∏—Å—Ç–æ—Ä–∏–∏.', 'bot');
                    }
                }
            });

            // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
            function formatBotResponse(text) {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ HTML —Ç–µ–≥–∏, –∫—Ä–æ–º–µ <br> –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                text = text.replace(/<(?!br\s*\/?)[^>]+>/g, '');

                // –ó–∞–º–µ–Ω—è–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã–µ <br> –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∞—Ä–∫–µ—Ä
                text = text.replace(/<br\s*\/?>/g, '¬ßBREAK¬ß');

                // –ù–∞—Ö–æ–¥–∏–º –¥–≤–æ–π–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏ –∑–∞–º–µ–Ω—è–µ–º –∏—Ö –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã –∫–æ–Ω—Ü–∞/–Ω–∞—á–∞–ª–∞ –∞–±–∑–∞—Ü–∞
                text = text.replace(/¬ßBREAK¬ß¬ßBREAK¬ß/g, '¬ßPARAGRAPH¬ß');

                // –ó–∞–º–µ–Ω—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ <br>
                text = text.replace(/¬ßBREAK¬ß/g, '<br>');

                // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –∞–±–∑–∞—Ü—ã
                const paragraphs = text.split('¬ßPARAGRAPH¬ß');

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –∞–±–∑–∞—Ü
                const formattedParagraphs = paragraphs.map(paragraph => {
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
                    paragraph = paragraph.replace(/^([-‚Ä¢])\s+(.+?)(<br>|$)/gm, '<li>$2</li>');
                    paragraph = paragraph.replace(/<br>([-‚Ä¢])\s+(.+?)(<br>|$)/g, '<br><li>$2</li>');

                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
                    paragraph = paragraph.replace(/^(\d+)[.)][\s]+(.+?)(<br>|$)/gm, '<li>$2</li>');
                    paragraph = paragraph.replace(/<br>(\d+)[.)][\s]+(.+?)(<br>|$)/g, '<br><li>$2</li>');

                    // –ï—Å–ª–∏ –≤ –∞–±–∑–∞—Ü–µ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∏—Ö –≤ <ul>
                    if (paragraph.includes('<li>')) {
                        paragraph = '<ul>' + paragraph + '</ul>';
                        // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ br –≤–Ω—É—Ç—Ä–∏ —Å–ø–∏—Å–∫–æ–≤
                        paragraph = paragraph.replace(/<li>(.*?)<br><\/li>/g, '<li>$1</li>');
                    }

                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
                    paragraph = paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    paragraph = paragraph.replace(/\*(.*?)\*/g, '<em>$1</em>');

                    return paragraph;
                });

                // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∞–±–∑–∞—Ü –≤ <p> –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –≤–º–µ—Å—Ç–µ
                return formattedParagraphs.map(p => `<p>${p}</p>`).join('');
            }

            function appendMessage(text, sender = 'bot') {
                const msg = document.createElement('div');
                msg.className = `message ${sender}`;
                chat.appendChild(msg);

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫ –æ—Ç–≤–µ—Ç–∞–º –±–æ—Ç–∞
                if (sender === 'bot') {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∞—Å—Ç—å —Å "–ë–æ—Ç: " –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç
                    if (text.startsWith('–ë–æ—Ç: ')) {
                        const botPrefix = '–ë–æ—Ç: ';
                        const responseText = text.substring(botPrefix.length);
                        const formattedText = formatBotResponse(responseText);
                        msg.innerHTML = botPrefix + formattedText;
                    } else {
                        // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞ "–ë–æ—Ç: ", —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç
                        msg.innerHTML = formatBotResponse(text);
                    }
                } else {
                    // –î–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                    msg.textContent = text;
                }

                chat.scrollTop = chat.scrollHeight;
            }

            async function ask() {
                const q = questionInput.value;
                if (!q.trim()) return;

                appendMessage(q, 'user');
                questionInput.value = '';
                questionInput.blur(); // –£–±–∏—Ä–∞–µ–º —Ñ–æ–∫—É—Å —Å –ø–æ–ª—è –≤–≤–æ–¥–∞, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

                const botMsg = document.createElement('div');
                botMsg.className = 'message bot';
                botMsg.innerHTML = '<b>–ë–æ—Ç:</b> <span id="typing">–î—É–º–∞—é...</span>';
                chat.appendChild(botMsg);
                chat.scrollTop = chat.scrollHeight;

                try {
                    const res = await fetch('/chatbot-proxy.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: 'q=' + encodeURIComponent(q)
                    });

                    const data = await res.json();
                    botMsg.remove(); // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–î—É–º–∞—é..."

                    const text = data.answer || '‚ö†Ô∏è –û—à–∏–±–∫–∞: –æ—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω.';
                    appendMessage('–ë–æ—Ç: ' + text, 'bot');

                    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
                    sourcesContainer.innerHTML = '';

                    if (data.sources) {
                        sourcesContainer.innerHTML = '<b>üîé –ò—Å—Ç–æ—á–Ω–∏–∫–∏:</b><br>' + data.sources;
                    }
                } catch (error) {
                    botMsg.remove();
                    appendMessage('–ë–æ—Ç: ‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                    console.error('Error:', error);
                }

                chat.scrollTop = chat.scrollHeight;

                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
                setTimeout(() => {
                    questionInput.focus();
                }, 300);
            }

            sendButton.addEventListener('click', ask);
            questionInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') ask();
            });

            // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤—ã—Å–æ—Ç–æ–π viewport –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            const originalHeight = window.innerHeight;
            window.addEventListener('resize', function() {
                if (window.innerHeight < originalHeight) {
                    // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                    document.body.style.height = window.innerHeight + 'px';
                } else {
                    // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∑–∞–∫—Ä—ã—Ç–∞
                    document.body.style.height = '100vh';
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            appendMessage('–ë–æ—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –±–∞–Ω–∫–æ–≤—Å–∫–æ–º—É –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –ß–µ–º —è –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?', 'bot');
        });
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
async function checkIndexStatus() {
try {
    const response = await fetch('/chatbot-proxy.php?action=index_status');
    const data = await response.json();

    const statusIndicator = document.querySelector('.status-indicator');
    const statusText = document.getElementById('indexStatusText');
    const indexStatus = document.getElementById('indexStatus');

    indexStatus.style.display = 'flex';

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –∞–¥–º–∏–Ω–∫–µ –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
    const progressBar = document.getElementById('indexProgressBar');
    const progressText = document.getElementById('indexProgressText');
    const progressContainer = document.querySelector('.index-progress-container');

    if (progressBar && data.percent !== undefined) {
        progressBar.style.width = data.percent + '%';
        progressText.textContent = data.percent + '% - ' + data.message;
        progressContainer.style.display = 'block';
    }

    if (data.status === 'completed') {
        statusIndicator.className = 'status-indicator complete';
        statusText.textContent = '–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞';

        // –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        if (window.lastIndexStatus === 'in_progress') {
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        }
    } else if (data.status === 'in_progress') {
        statusIndicator.className = 'status-indicator';
        statusText.textContent = '–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ: ' + data.percent + '%';

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(checkIndexStatus, 5000);
    } else if (data.status === 'error') {
        statusIndicator.className = 'status-indicator error';
        statusText.textContent = '–û—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏: ' + data.message;
    } else {
        statusIndicator.className = 'status-indicator';
        statusText.textContent = '–°—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏: ' + data.message;
    }

    window.lastIndexStatus = data.status;
} catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:', error);
    document.getElementById('indexStatus').style.display = 'none';
}
}

// –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
const checkIndexButton = document.getElementById('checkIndexButton');
if (checkIndexButton) {
checkIndexButton.addEventListener('click', checkIndexStatus);
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
checkIndexStatus();

// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–≤–µ—Ä—Ö
const scrollTopButton = document.createElement('div');
scrollTopButton.className = 'scroll-top-button';
scrollTopButton.innerHTML = '‚Üë';
scrollTopButton.addEventListener('click', () => {
chat.scrollTo({ top: 0, behavior: 'smooth' });
});
document.body.appendChild(scrollTopButton);

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
chat.addEventListener('scroll', () => {
if (chat.scrollTop > 300) {
    scrollTopButton.classList.add('visible');
} else {
    scrollTopButton.classList.remove('visible');
}
});

// –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
const themeSwitcher = document.createElement('div');
themeSwitcher.className = 'theme-switcher';
themeSwitcher.innerHTML = '‚òÄÔ∏è';
themeSwitcher.title = '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É';
document.body.appendChild(themeSwitcher);

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
if (localStorage.getItem('theme') === 'light') {
document.body.classList.add('light-theme');
themeSwitcher.innerHTML = 'üåô';
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
themeSwitcher.addEventListener('click', () => {
document.body.classList.toggle('light-theme');
if (document.body.classList.contains('light-theme')) {
    localStorage.setItem('theme', 'light');
    themeSwitcher.innerHTML = 'üåô';
} else {
    localStorage.setItem('theme', 'dark');
    themeSwitcher.innerHTML = '‚òÄÔ∏è';
}
});

// –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º
function addTimeToMessage(messageElement) {
const timeElement = document.createElement('span');
timeElement.className = 'message-time';
const now = new Date();
timeElement.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
messageElement.appendChild(timeElement);
}

// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é appendMessage –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
const originalAppendMessage = appendMessage;
appendMessage = function(text, sender = 'bot') {
const msg = document.createElement('div');
msg.className = `message ${sender}`;
chat.appendChild(msg);

// –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏
addTimeToMessage(msg);

// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫ –æ—Ç–≤–µ—Ç–∞–º –±–æ—Ç–∞
if (sender === 'bot') {
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏ –¥–ª—è –±–æ—Ç–∞
    if (text.startsWith('–ë–æ—Ç: ')) {
        const botPrefix = '–ë–æ—Ç: ';
        if (text.includes('–î—É–º–∞—é...')) {
            msg.innerHTML = botPrefix + '<span id="typing" class="typing-animation">–î—É–º–∞—é</span>';
        } else {
            const responseText = text.substring(botPrefix.length);
            const formattedText = formatBotResponse(responseText);
            msg.innerHTML = botPrefix + formattedText;

            // –î–æ–±–∞–≤–ª—è–µ–º –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
            if (responseText.includes('?') && !responseText.includes('–û—à–∏–±–∫–∞:')) {
                addQuickReplies(msg);
            }
        }
    } else {
        msg.innerHTML = formatBotResponse(text);
    }
} else {
    msg.textContent = text;
}

chat.scrollTop = chat.scrollHeight;
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
function addQuickReplies(messageElement) {
// –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–∏—á–Ω—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
const replies = [
    '–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º',
    '–°–ø–∞—Å–∏–±–æ, –ø–æ–Ω—è—Ç–Ω–æ',
    '–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è',
    '–ß—Ç–æ –µ—â–µ –ø–æ—á–∏—Ç–∞—Ç—å?'
];

const quickRepliesDiv = document.createElement('div');
quickRepliesDiv.className = 'quick-replies';

replies.forEach(reply => {
    const quickReply = document.createElement('div');
    quickReply.className = 'quick-reply';
    quickReply.textContent = reply;
    quickReply.addEventListener('click', () => {
        questionInput.value = reply;
        ask();
    });
    quickRepliesDiv.appendChild(quickReply);
});

messageElement.appendChild(quickRepliesDiv);
}

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
function formatBotResponse(text) {
// –í—ã–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
text = text.replace(/```([^`]+)```/g, '<div class="code-block">$1</div>');

// –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
// –£–¥–∞–ª—è–µ–º –≤—Å–µ HTML —Ç–µ–≥–∏, –∫—Ä–æ–º–µ <br> –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
text = text.replace(/<(?!br\s*\/?)[^>]+>/g, '');
// –ó–∞–º–µ–Ω—è–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã–µ <br> –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∞—Ä–∫–µ—Ä
text = text.replace(/<br\s*\/?>/g, '¬ßBREAK¬ß');
// –ù–∞—Ö–æ–¥–∏–º –¥–≤–æ–π–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏ –∑–∞–º–µ–Ω—è–µ–º –∏—Ö –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã –∫–æ–Ω—Ü–∞/–Ω–∞—á–∞–ª–∞ –∞–±–∑–∞—Ü–∞
text = text.replace(/¬ßBREAK¬ß¬ßBREAK¬ß/g, '¬ßPARAGRAPH¬ß');
// –ó–∞–º–µ–Ω—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ <br>
text = text.replace(/¬ßBREAK¬ß/g, '<br>');

// –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –∞–±–∑–∞—Ü—ã
const paragraphs = text.split('¬ßPARAGRAPH¬ß');

// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –∞–±–∑–∞—Ü
const formattedParagraphs = paragraphs.map(paragraph => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –±–ª–æ–∫–æ–º –∫–æ–¥–∞
    if (paragraph.includes('<div class="code-block">')) {
        return paragraph;
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
    paragraph = paragraph.replace(/^([-‚Ä¢])\s+(.+?)(<br>|$)/gm, '<li>$2</li>');
    paragraph = paragraph.replace(/<br>([-‚Ä¢])\s+(.+?)(<br>|$)/g, '<br><li>$2</li>');

    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
    paragraph = paragraph.replace(/^(\d+)[.)][\s]+(.+?)(<br>|$)/gm, '<li>$2</li>');
    paragraph = paragraph.replace(/<br>(\d+)[.)][\s]+(.+?)(<br>|$)/g, '<br><li>$2</li>');

    // –ï—Å–ª–∏ –≤ –∞–±–∑–∞—Ü–µ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∏—Ö –≤ <ul>
    if (paragraph.includes('<li>')) {
        paragraph = '<ul>' + paragraph + '</ul>';
        // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ br –≤–Ω—É—Ç—Ä–∏ —Å–ø–∏—Å–∫–æ–≤
        paragraph = paragraph.replace(/<li>(.*?)<br><\/li>/g, '<li>$1</li>');
    }

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    paragraph = paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    paragraph = paragraph.replace(/\*(.*?)\*/g, '<em>$1</em>');

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
    paragraph = paragraph.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

    return paragraph;
});

// –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π –∞–±–∑–∞—Ü –≤ <p> –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –≤–º–µ—Å—Ç–µ
return formattedParagraphs.map(p => `<p>${p}</p>`).join('');
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞ –±—ç–∫–µ–Ω–¥–µ)
function addFileUploadButton() {
const fileUploadContainer = document.createElement('div');
fileUploadContainer.className = 'file-upload-container';

const fileUploadLabel = document.createElement('label');
fileUploadLabel.className = 'file-upload-button';
fileUploadLabel.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç';

const fileInput = document.createElement('input');
fileInput.type = 'file';
fileInput.id = 'documentUpload';
fileInput.accept = '.pdf,.docx,.txt,.html';

const fileName = document.createElement('span');
fileName.className = 'file-name';

fileUploadLabel.appendChild(fileInput);
fileUploadContainer.appendChild(fileUploadLabel);
fileUploadContainer.appendChild(fileName);

// –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –ø–∞–Ω–µ–ª—å—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
const adminPanel = document.getElementById('adminPanel');
document.body.insertBefore(fileUploadContainer, adminPanel);

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
fileInput.addEventListener('change', function() {
    if (this.files && this.files[0]) {
        fileName.textContent = this.files[0].name;

        // –ï—Å–ª–∏ —É –≤–∞—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤, –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        // –ù–∞–ø—Ä–∏–º–µ—Ä:
        /*
        const formData = new FormData();
        formData.append('file', this.files[0]);

        fetch('/chatbot-proxy.php?action=upload_document', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                appendMessage('–ë–æ—Ç: –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é.', 'bot');
            } else {
                appendMessage('–ë–æ—Ç: –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç. ' + data.message, 'bot');
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:', error);
            appendMessage('–ë–æ—Ç: –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.', 'bot');
        });
        */

        // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
        appendMessage('–ë–æ—Ç: –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∏–º–µ—é—â–µ–π—Å—è –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.', 'bot');
    }
});
}

// –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
// addFileUploadButton();

// –£–ª—É—á—à–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é ARIA-–∞—Ç—Ä–∏–±—É—Ç–æ–≤
function enhanceAccessibility() {
// –î–æ–±–∞–≤–ª—è–µ–º ARIA —Ä–æ–ª–∏ –∏ –º–µ—Ç–∫–∏
chat.setAttribute('role', 'log');
chat.setAttribute('aria-live', 'polite');
chat.setAttribute('aria-label', '–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞');

questionInput.setAttribute('aria-label', '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å');
sendButton.setAttribute('aria-label', '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å');
clearHistoryButton.setAttribute('aria-label', '–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞');

// –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–∫—Ä–∏–Ω—Ä–∏–¥–µ—Ä–æ–≤
const srOnly = document.createElement('span');
srOnly.style.cssText = 'position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;';
srOnly.setAttribute('id', 'sr-status');
srOnly.setAttribute('aria-live', 'polite');
document.body.appendChild(srOnly);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø–æ–≤–µ—â–µ–Ω–∏—è —Å–∫—Ä–∏–Ω—Ä–∏–¥–µ—Ä–æ–≤ –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
window.notifyScreenReader = function(text) {
    document.getElementById('sr-status').textContent = text;
};
}

// –í–∫–ª—é—á–∞–µ–º —É–ª—É—á—à–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
enhanceAccessibility();

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
function addSaveDialogButton() {
const saveButton = document.createElement('button');
saveButton.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∞–ª–æ–≥';
saveButton.className = 'admin-button';
saveButton.style.marginLeft = '10px';
saveButton.setAttribute('aria-label', '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥ –≤ —Ñ–∞–π–ª');

saveButton.addEventListener('click', function() {
    const messages = Array.from(chat.children);
    let dialogText = '';

    messages.forEach(msg => {
        const isBot = msg.classList.contains('bot');
        const text = msg.textContent.trim();
        dialogText += (isBot ? '–ë–æ—Ç: ' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ') + text + '\n\n';
    });

    const blob = new Blob([dialogText], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = '–¥–∏–∞–ª–æ–≥-—Å-–±–æ—Ç–æ–º-' + new Date().toISOString().slice(0, 10) + '.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});

// –î–æ–±–∞–≤–ª—è–µ–º —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
clearHistoryButton.parentNode.insertBefore(saveButton, clearHistoryButton.nextSibling);
}
    </script>
</body>
</html>
